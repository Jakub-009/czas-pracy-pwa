<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Czas pracy</title>
  <meta name="theme-color" content="#f6f7fb" />
  <meta name="color-scheme" content="light">
  <link rel="manifest" href="/czas-pracy-pwa/manifest.webmanifest">

  <style>
    *{box-sizing:border-box}

    :root{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;

      --bg:#f6f7fb;
      --surface:#ffffff;
      --surface-soft:rgba(255,255,255,.7);
      --outline-soft:rgba(17,17,17,.08);

      --primary:#50827C;
      --primary-soft:rgba(80,130,124,.12);

      --danger:#d92d20;
      --danger-soft:rgba(217,45,32,.12);

      --sat:rgba(60,64,67,.65);
      --sun:#d93025;
      --holiday:#d93025;

      --bar-work:#1e8e3e;
      --bar-note:#f9ab00;
      --bar-vac:#1a73e8;

      /* tła modali */
      --vac-bg:rgba(26,115,232,.12);
      --bulk-bg:rgba(80,130,124,.14);

      --radius-lg:20px;
      --radius-md:16px;
      --radius-sm:12px;
    }

    html,body{ width:100%; overflow-x:hidden; }
    body{ margin:0; background:var(--bg); color:#111; }

    .wrap{
      max-width:980px;
      margin:18px auto;
      padding:0 14px 90px;
    }

    .section{
      border-bottom:1px solid var(--outline-soft);
      padding-bottom:14px;
      margin-bottom:14px;
    }
    .section:last-of-type{ border-bottom:none; padding-bottom:0; margin-bottom:0; }

    .appHeader{ text-align:center; margin:14px 0 8px; }
    .appHeader h1{ font-size:22px; font-weight:800; margin:0; }
    .appHeader .emoji{ margin-left:6px; opacity:.75; }

    label{
      display:block;
      font-size:12px;
      color:rgba(17,17,17,.65);
      margin-bottom:6px;
    }
    .muted{ font-size:12.5px; color:rgba(17,17,17,.6); }

    .row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .twoCols{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }

    input,textarea,select{
      width:100%;
      padding:12px 14px;
      border-radius:var(--radius-lg);
      border:1px solid var(--outline-soft);
      background:var(--surface-soft);
      font-size:14px;
      transition:border-color .15s ease, box-shadow .15s ease;
    }
    textarea{ min-height:44px; resize:vertical; }
    input:focus-visible,
    textarea:focus-visible,
    select:focus-visible{
      border-color:var(--primary);
      box-shadow:0 0 0 4px var(--primary-soft);
    }

    button{
      padding:12px 16px;
      border-radius:var(--radius-lg);
      border:none;
      font-size:15px;
      font-weight:500;
      background:var(--primary);
      color:#fff;
      cursor:pointer;
      transition:filter .15s ease, transform .08s ease;
    }
    button.secondary{ background:var(--primary-soft); color:#0f2f2b; }
    button.danger{ background:var(--danger-soft); color:#7a1410; }
    button:active{ transform:scale(.98); }
    button:disabled{ opacity:.5; cursor:not-allowed; }

    .chev{
      width:18px; height:18px;
      display:inline-flex;
      align-items:center; justify-content:center;
      opacity:.6;
      transition:transform .18s ease;
    }
    .chev::before{
      content:"";
      width:8px; height:8px;
      border-right:2px solid #111;
      border-bottom:2px solid #111;
      transform:rotate(45deg);
    }
    details[open] .chev{ transform:rotate(180deg); }
    details summary{
      cursor:pointer;
      font-weight:600;
      display:flex;
      justify-content:space-between;
      align-items:center;
      list-style:none;
      padding:10px 0;
    }
    details summary::-webkit-details-marker{display:none}
    .panel{ margin-top:10px; animation:panelIn .18s ease; }
    @keyframes panelIn{ from{opacity:.4; transform:translateY(-4px)} to{opacity:1; transform:translateY(0)} }

    .topMonthBar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding:10px 0 2px;
    }
    .monthTitle{ font-size:18px; font-weight:800; line-height:1.1; }
    .monthActions{ display:flex; gap:8px; align-items:center; position:relative; }

    .chip{
      border:1px solid var(--outline-soft);
      background:var(--surface-soft);
      padding:8px 12px;
      border-radius:999px;
      font-weight:600;
      font-size:13px;
      color:#111;
      cursor:pointer;
    }
    .chip:active{ transform:scale(.98); }

    .iconCircle{
      width:42px; height:42px;
      border-radius:999px;
      border:1px solid var(--outline-soft);
      background:var(--surface-soft);
      cursor:pointer;
      display:grid;
      place-items:center;
      position:relative;
    }
    .iconCircle svg{ width:20px; height:20px; opacity:.85; }
    #monthPick{
      position:absolute;
      inset:0;
      opacity:0;
      cursor:pointer;
      appearance:none;
      -webkit-appearance:none;
    }

    /* KALENDARZ */
    .calGrid{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      gap:8px;
    }
    .calDow{
      text-align:center;
      font-size:12px;
      color:rgba(17,17,17,.55);
      padding:2px 0;
    }

    .dayCell{
      border-radius:16px;
      border:1px solid var(--outline-soft);
      background:var(--surface-soft);
      padding:4px 10px 10px;
      cursor:pointer;
      position:relative;
      display:flex;
      flex-direction:column;
      justify-content:flex-start;
      align-items:stretch;
    }
    .blankCell{
      border:none;
      background:transparent;
      box-shadow:none;
      pointer-events:none;
    }
    .dayTop{
      width:100%;
      display:flex;
      justify-content:center;
      align-items:flex-start;
    }
    .dayNum{
      width:100%;
      text-align:center;
      font-size:16px;
      font-weight:750;
      line-height:1.05;
      margin-top:2px;
    }
    .dayNum.saturday{ color:var(--sat); font-weight:650; }
    .dayNum.sunday{ color:var(--sun); }
    .dayNum.holiday{ color:var(--holiday); }
    .dayNum.saturday.holiday{ color:var(--holiday); font-weight:750; }

    .dayCell.today{
      border-color:rgba(26,115,232,.35);
      box-shadow:0 0 0 3px rgba(26,115,232,.12);
      background:rgba(255,255,255,.85);
    }

    .indRow{
      position:absolute;
      left:0; right:0;
      bottom:10px;
      display:flex;
      flex-direction:column;
      gap:4px;
      align-items:center;
      pointer-events:none;
    }
    .bar{ display:block; height:4px; width:64%; border-radius:999px; }
    .bar.shift{ background:var(--bar-work); }
    .bar.note{ background:var(--bar-note); }
    .bar.vacation{ background:var(--bar-vac); }
    .bar.hidden{ display:none; }

    @media(max-width:420px){
      .indRow{ bottom:8px; gap:3px; }
      .bar{ height:3px; width:66%; }
    }

    .dayCell, .blankCell{ aspect-ratio: 1 / 1.15; min-height:0; }
    @media (min-width:520px){ .dayCell, .blankCell{ aspect-ratio: 1 / 1.05; } }
    @media (min-width:900px){ .dayCell, .blankCell{ aspect-ratio: 1 / 1; min-height:74px; } }
    @supports not (aspect-ratio: 1 / 1){ .dayCell, .blankCell{ min-height:74px; } }

    .statBox{
      background:var(--primary-soft);
      border-radius:16px;
      padding:12px 14px;
    }
    .statValue{ font-size:22px; font-weight:900; margin-top:4px; }

    /* ===== MODAL DNIA (pełny ekran) ===== */
    dialog#dayDialog{
      border:none;
      padding:0;
      width:100vw;
      height:100dvh;
      max-width:100vw;
      max-height:100dvh;
      margin:0;
      border-radius:0;
      box-shadow:0 18px 60px rgba(0,0,0,.25);
      overflow:hidden;
    }
    dialog#dayDialog::backdrop{ background:rgba(17,17,17,.45); }

    /* ===== MODALE PŁYWAJĄCE ===== */
    dialog#vacDialog,
    dialog#bulkDialog{
      border:none;
      padding:0;
      width:min(560px, calc(100vw - 28px));
      max-width:560px;
      margin:auto;
      border-radius:22px;
      box-shadow:0 18px 60px rgba(0,0,0,.25);
      overflow:hidden;
    }
    dialog#vacDialog::backdrop,
    dialog#bulkDialog::backdrop{ background:rgba(17,17,17,.45); }

    .modalHead{
      background:var(--bg);
      padding:16px 16px 14px;
      border-bottom:1px solid var(--outline-soft);
      position:sticky;
      top:0;
      z-index:2;
    }
    .modalBody{
      padding:16px;
      background:var(--bg);
    }

    /* tła dla modali */
    #vacDialog .modalBody{ background:var(--vac-bg); }
    #bulkDialog .modalBody{ background:var(--bulk-bg); }

    /* back button (wspólne) */
    .backBtn{
      width:44px;
      height:44px;
      padding:0;
      border-radius:18px;
      border:1px solid var(--outline-soft);
      background:var(--primary);
      color:#fff;
      cursor:pointer;
      display:grid;
      place-items:center;
      position:absolute;
      top:10px;
      right:12px;
      left:auto;
    }
    .backBtn.blue{
      background:var(--bar-vac);
      border:1px solid rgba(26,115,232,.18);
    }
    .backBtn svg{ width:20px; height:20px; opacity:.92; }

    .modalHeadInner{ padding-right:58px; }

    .modalStats{
      display:flex;
      justify-content:space-between;
      align-items:stretch;
      gap:12px;
      margin-bottom:14px;
      flex-wrap:nowrap;
    }
    .statMini{
      flex:1;
      min-width:0;
      background:var(--primary-soft);
      border-radius:16px;
      padding:12px 14px;
    }
    .statMiniValue{
      font-size:20px;
      font-weight:900;
      margin-top:4px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    @media(max-width:380px){ .statMiniValue{ font-size:18px; } }

    .modalStack{
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .timeGrid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    @media(max-width:520px){
      .timeGrid{ grid-template-columns:1fr 1fr; gap:10px; }
    }
    .addBtnCenter{
      width:min(320px, 100%);
      margin:4px auto 0;
      display:block;
    }

    .shiftList{
      display:flex;
      flex-direction:column;
      gap:12px;
      margin-top:10px;
    }
    .shiftItem{
      border:none;
      background:var(--primary-soft);
      border-radius:16px;
      padding:12px 12px;
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:flex-start;
    }
    .shiftItem .times{ font-weight:650; font-size:16px; }
    .shiftItem .mins{
      font-size:12.5px;
      color:rgba(17,17,17,.6);
      margin-top:4px;
    }

    .delIcon{
      width:36px;
      height:36px;
      border-radius:18px;
      border:1px solid rgba(217,45,32,.22);
      background:rgba(217,45,32,.10);
      cursor:pointer;
      position:relative;
      flex:0 0 auto;
    }
    .delIcon::before,.delIcon::after{
      content:"";
      position:absolute;
      top:50%;
      left:50%;
      width:14px;
      height:2px;
      background:#7a1410;
      border-radius:2px;
      transform-origin:center;
    }
    .delIcon::before{ transform:translate(-50%,-50%) rotate(45deg); }
    .delIcon::after{ transform:translate(-50%,-50%) rotate(-45deg); }

    body.modal-open{
      overflow:hidden;
      height:100vh;
      touch-action:none;
    }

    /* Przyciski pod kalendarzem */
    .bulkBtn{
      width:100%;
      background:rgba(80,130,124,.14);
      border:1px solid rgba(80,130,124,.18);
      color:#0f2f2b;
      font-weight:900;
    }
    .vacBtn{
      width:100%;
      background:rgba(26,115,232,.12);
      border:1px solid rgba(26,115,232,.18);
      color:#0b2d64;
      font-weight:900;
    }

    /* Układ w modalach: od/do obok siebie + bez ramek wokół */
    .rangeRow{
      display:flex;
      gap:10px;
      flex-wrap:nowrap;
      align-items:flex-end;
    }
    .rangeRow > *{ flex:1; min-width:0; }
    @media(max-width:380px){
      .rangeRow{ flex-wrap:wrap; }
      .rangeRow > *{ min-width:160px; }
    }

    .actionRow{
      display:flex;
      gap:10px;
      margin-top:12px;
    }
    .actionRow > *{ flex:1; }

    /* FAB */
    .fab{
      position:fixed;
      right:16px;
      bottom:16px;
      width:56px;
      height:56px;
      border-radius:18px;
      border:none;
      background:var(--primary);
      color:#fff;
      cursor:pointer;
      display:grid;
      place-items:center;
      z-index:999;
    }
    .fab:active{ transform:scale(.98); }
    .fab svg{ width:22px;height:22px; }

    *{-webkit-tap-highlight-color:transparent}
    :focus{outline:none}
    :focus-visible{
      outline:2px solid var(--primary);
      outline-offset:2px;
      border-radius:12px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="appHeader">
      <h1>Czas pracy <span class="emoji">⏱️</span></h1>
    </header>

    <div class="section">
      <div class="topMonthBar">
        <div class="monthTitle" id="monthLabelText">—</div>

        <div class="monthActions">
          <button class="chip" id="todayBtn" type="button">Dzisiaj</button>

          <div class="iconCircle" id="monthBar" title="Wybierz miesiąc" aria-label="Wybierz miesiąc">
            <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path fill="currentColor" d="M7 2a1 1 0 0 1 1 1v1h8V3a1 1 0 1 1 2 0v1h1a3 3 0 0 1 3 3v13a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h1V3a1 1 0 0 1 1-1Zm12 8H5v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V10ZM6 6a1 1 0 0 0-1 1v1h14V7a1 1 0 0 0-1-1H6Z"/>
            </svg>
            <input id="monthPick" type="month" aria-label="Wybierz miesiąc" />
          </div>
        </div>
      </div>

      <div class="twoCols" style="margin-top:12px;">
        <div class="statBox">
          <div class="muted">Suma godzin w miesiącu</div>
          <div class="statValue" id="sumHours">0:00</div>
        </div>
        <div class="statBox">
          <div class="muted">Wypłata</div>
          <div class="statValue" id="sumPay">0,00 zł</div>
        </div>
      </div>

      <div class="muted" id="status" style="margin-top:10px;"></div>
    </div>

    <!-- KALENDARZ (to wraca i nie może zniknąć) -->
    <div class="section">
      <div class="calGrid" id="dowRow" style="margin-bottom:6px;"></div>
      <div class="calGrid" id="calGrid"></div>

      <div class="row" style="margin-top:14px;">
        <button class="bulkBtn" id="openBulkDialog" type="button">Dodaj wiele godzin</button>
      </div>
      <div class="row" style="margin-top:10px;">
        <button class="vacBtn" id="openVacDialog" type="button">Dodaj urlop</button>
      </div>
    </div>

    <div class="section">
      <details id="extrasPanel">
        <summary>
          <span>Ustawienia pracodawcy</span>
          <span class="chev" aria-hidden="true"></span>
        </summary>
        <div class="panel">
          <div class="row" style="margin-top:12px;">
            <div style="flex:1; min-width:240px;">
              <label>Stawka godzinowa (PLN)</label>
              <input id="rate" type="number" step="0.01" min="0" value="40" />
            </div>
          </div>
        </div>
      </details>
    </div>

    <div class="section">
      <details id="toolsPanel">
        <summary>
          <span>Narzędzia</span>
          <span class="chev" aria-hidden="true"></span>
        </summary>
        <div class="panel">
          <div class="row" style="margin-top:12px;">
            <button class="danger" id="clearMonth" type="button" style="flex:1; min-width:240px;">Usuń cały miesiąc</button>
            <button class="secondary" id="backupJson" type="button" style="flex:1; min-width:180px;">Kopia zapasowa</button>

            <input id="restoreJson" type="file" accept="application/json" style="display:none" />
            <button class="secondary" id="restoreBtn" type="button" style="flex:1; min-width:180px;">Przywróć kopię zapasową</button>
          </div>
        </div>
      </details>
    </div>
  </div>

  <!-- FAB -->
  <button class="fab" id="fabAdd" aria-label="Dodaj godziny (dzisiaj)" title="Dodaj (dzisiaj)" type="button">
    <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
      <path fill="currentColor" d="M11 5a1 1 0 0 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6V5z"/>
    </svg>
  </button>

  <!-- MODAL URLOPU (pływający) -->
  <dialog id="vacDialog">
    <div class="modalHead" style="position:relative;">
      <div class="modalHeadInner">
        <h3 style="margin:0;">Dodaj urlop</h3>
        <div class="muted" style="margin-top:3px;">Po ustawieniu urlopu dni w kalendarzu oznaczą się na niebiesko.</div>
      </div>

      <button class="backBtn blue" id="vacBack" aria-label="Zamknij" type="button" title="Zamknij">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="currentColor" d="M14.7 6.3a1 1 0 0 1 0 1.4L10.41 12l4.3 4.3a1 1 0 1 1-1.42 1.4l-5-5a1 1 0 0 1 0-1.4l5-5a1 1 0 0 1 1.41 0Z"/>
        </svg>
      </button>
    </div>

    <div class="modalBody">
      <div class="rangeRow">
        <div>
          <label>Od</label>
          <input id="vacFrom" type="date" />
        </div>
        <div>
          <label>Do</label>
          <input id="vacTo" type="date" />
        </div>
      </div>

      <div class="actionRow">
        <button id="setVacationRange" type="button" style="background:var(--bar-vac); font-weight:900;">Dodaj</button>
        <button class="danger" id="clearVacationRange" type="button" style="font-weight:900;">Usuń</button>
      </div>

      <div style="height:6px;"></div>
    </div>
  </dialog>

  <!-- MODAL WIELE GODZIN (pływający) -->
  <dialog id="bulkDialog">
    <div class="modalHead" style="position:relative;">
      <div class="modalHeadInner">
        <h3 style="margin:0;">Dodaj wiele godzin</h3>
        <div class="muted" style="margin-top:3px;">Ustaw zakres dat i jedną parę wejścia/wyjścia dla wszystkich dni (dni z urlopem są pomijane).</div>
      </div>

      <button class="backBtn" id="bulkBack" aria-label="Zamknij" type="button" title="Zamknij">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="currentColor" d="M14.7 6.3a1 1 0 0 1 0 1.4L10.41 12l4.3 4.3a1 1 0 1 1-1.42 1.4l-5-5a1 1 0 0 1 0-1.4l5-5a1 1 0 0 1 1.41 0Z"/>
        </svg>
      </button>
    </div>

    <div class="modalBody">
      <div class="rangeRow">
        <div>
          <label>Od</label>
          <input id="bulkFrom" type="date" />
        </div>
        <div>
          <label>Do</label>
          <input id="bulkTo" type="date" />
        </div>
      </div>

      <div class="timeGrid" style="margin-top:12px;">
        <div>
          <label>Godzina wejścia</label>
          <input id="bulkStart" type="time" />
        </div>
        <div>
          <label>Godzina wyjścia</label>
          <input id="bulkEnd" type="time" />
        </div>
      </div>

      <div class="actionRow">
        <button id="bulkApply" type="button" style="background:var(--primary); font-weight:900;">Dodaj</button>
        <button id="bulkRemove" type="button" class="danger" style="font-weight:900;">Usuń godziny</button>
      </div>

      <div class="muted" style="margin-top:10px; line-height:1.35;">
        Uwaga: „Dodaj” dopisuje zakres do każdego dnia (nie nadpisuje istniejących). „Usuń godziny” usuwa w tych dniach dokładnie ten sam zakres (jeśli istnieje).
      </div>

      <div style="height:6px;"></div>
    </div>
  </dialog>

  <!-- MODAL DNIA (pełny ekran) -->
  <dialog id="dayDialog">
    <div class="modalHead" style="position:relative;">
      <div class="modalHeadInner">
        <h3 id="dlgTitle" style="margin:0;">Dzień</h3>
        <div class="muted" id="dlgMeta" style="margin-top:3px;"></div>
      </div>

      <button class="backBtn" id="dlgBack" aria-label="Wróć" type="button" title="Wróć">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path fill="currentColor" d="M14.7 6.3a1 1 0 0 1 0 1.4L10.41 12l4.3 4.3a1 1 0 1 1-1.42 1.4l-5-5a1 1 0 0 1 0-1.4l5-5a1 1 0 0 1 1.41 0Z"/>
        </svg>
  
